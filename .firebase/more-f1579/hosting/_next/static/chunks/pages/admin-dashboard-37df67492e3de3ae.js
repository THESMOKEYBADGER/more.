(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{3259:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin-dashboard",function(){return t(2784)}])},4394:function(e,a,t){"use strict";var s=t(5893);t(7294);var n=t(8461),i=t.n(n);a.Z=e=>{let{children:a}=e;return(0,s.jsx)("div",{className:i().container,children:(0,s.jsxs)("main",{className:i().main,children:[(0,s.jsx)("header",{className:i().header,children:(0,s.jsx)("h1",{})}),(0,s.jsx)("section",{className:i().content,children:a})]})})}},3444:function(e,a,t){"use strict";t.d(a,{I:function(){return l},db:function(){return c}});var s=t(3977);t(3059);var n=t(1259),i=t(9828),r=t(6650);let o=(0,s.ZF)({apiKey:"AIzaSyAS2RAJanlflg5Xudy8VCFiUMAz1tpEKFw",authDomain:"more-f1579.firebaseapp.com",projectId:"more-f1579",storageBucket:"more-f1579.appspot.com",messagingSenderId:"675524787031",appId:"1:675524787031:web:e122a81b58e5154dd15c12",measurementId:"G-TJSHHBM91X"});(0,r.cF)(o);let l=(0,n.v0)(o),c=(0,i.ad)(o)},2784:function(e,a,t){"use strict";let s;t.r(a),t.d(a,{default:function(){return S}});var n=t(5893),i=t(7294),r=t(1163),o=t(3349),l=t(3444),c=t(9828),d=t(7066),m=t(4394),p=t(6944),u=t.n(p),_=e=>{let{onAddCompany:a}=e,[t,s]=(0,i.useState)(""),[r,o]=(0,i.useState)("");return(0,n.jsxs)("form",{className:u().form,onSubmit:e=>{e.preventDefault(),a({name:t,location:r}),s(""),o("")},children:[(0,n.jsx)("input",{type:"text",placeholder:"Company Name",value:t,onChange:e=>s(e.target.value),required:!0,className:u().input}),(0,n.jsx)("input",{type:"text",placeholder:"Location",value:r,onChange:e=>o(e.target.value),required:!0,className:u().input}),(0,n.jsx)("button",{type:"submit",className:u().button,children:"Add Company"})]})};let h={1:"EarthChild project",2:"Green Pop",3:"Animal Ocean"};var g=e=>{let{totalUsers:a,usersPerInitiative:t}=e;return(0,n.jsx)("div",{className:u().statistics,children:(0,n.jsxs)("div",{className:u().initiativesCard,children:[(0,n.jsx)("h3",{className:u().statTitle,children:"Users per Initiative"}),(0,n.jsx)("div",{className:u().initiativeTable,children:Object.entries(t).map(e=>{let[a,t]=e;return(0,n.jsxs)("div",{className:u().initiativeRow,children:[(0,n.jsx)("span",{className:u().initiativeName,children:h[a]}),(0,n.jsx)("span",{className:u().initiativeCount,children:t})]},a)})})]})})},C=e=>{let{count:a}=e;return(0,n.jsx)("div",{className:u().totalUsersContainer,children:(0,n.jsxs)("div",{className:u().totalUsersCard,children:[(0,n.jsx)("h2",{className:u().totalUsersTitle,children:"Total Users"}),(0,n.jsx)("div",{className:u().totalUsersCount,children:a})]})})},x=t(6495),j=t(3148);j.kL.register(j.uw,j.f$,j.ZL,j.Dx,j.u,j.De);var v=e=>{let{initiativeData:a,companyData:t}=e,s={responsive:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Donations Overview"}}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:u().graphCard,children:[(0,n.jsx)("h2",{className:u().subtitle,children:"Donations by Initiative"}),(0,n.jsx)("div",{className:u().chartContainer,children:(0,n.jsx)(x.$Q,{data:a,options:s})})]}),(0,n.jsxs)("div",{className:u().graphCard,children:[(0,n.jsx)("h2",{className:u().subtitle,children:"Donations by Company"}),(0,n.jsx)("div",{className:u().chartContainer,children:(0,n.jsx)(x.$Q,{data:t,options:s})})]})]})},f=t(356),y=t(2975),N=t(4410),b=t(9085),M=t(4072),L=t(2352),E=e=>{let{companies:a,onUpdateLogo:t}=e,[s,r]=(0,i.useState)(null),o=e=>{r(e)},l=()=>{r(null)},c=async e=>{s&&e.length>0&&(await t(s.id,e[0]),l())};return(0,n.jsxs)("div",{className:u().companyList,children:[(0,n.jsx)("h2",{children:"Companies"}),a.map(e=>(0,n.jsx)("div",{className:u().companyItem,children:(0,n.jsxs)(f.Z,{children:[(0,n.jsx)(y.q,{src:e.logoUrl,size:"md",radius:"xl",alt:"".concat(e.name," logo"),onClick:()=>o(e),style:{cursor:"pointer"},children:e.name.charAt(0)}),(0,n.jsx)(N.x,{children:e.name})]})},e.id)),(0,n.jsx)(b.u,{opened:!!s,onClose:l,title:"Update Company Logo",children:(0,n.jsxs)(M.fh,{onDrop:c,accept:[L.LO.png,L.LO.jpeg,L.LO.svg],maxSize:5242880,children:[(0,n.jsx)(N.x,{align:"center",children:"Drag images here or click to select files"}),(0,n.jsx)(N.x,{align:"center",size:"sm",color:"dimmed",mt:5,children:"Allowed file types: PNG, JPEG, SVG. Max file size: 5MB"})]})})]})},w=t(1259);t(9033);var S=(s=()=>{let[e,a]=(0,o.F_)(l.I),[t,s]=(0,i.useState)([]),[p,h]=(0,i.useState)(0),[x,j]=(0,i.useState)({}),[f,y]=(0,i.useState)({}),[N,b]=(0,i.useState)([]),[M,L]=(0,i.useState)([]),w=(0,r.useRouter)();(0,i.useEffect)(()=>{a||e||w.push("/login")},[e,a,w]),(0,i.useEffect)(()=>{e&&(D(),I(),P())},[e]);let S=async e=>{try{await (0,c.ET)((0,c.hJ)(l.db,"companies"),e),D(),await U(e.name)}catch(e){console.error("Error adding company: ",e)}},U=async e=>{try{await d.Z.post("/api/notify-users",{companyName:e,users:M.map(e=>e.email)}),console.log("Notification request sent for all users")}catch(e){console.error("Error sending notification request: ",e)}},D=async()=>{try{let e=(await (0,c.PL)((0,c.hJ)(l.db,"companies"))).docs.map(e=>({id:e.id,...e.data()}));s(e)}catch(e){console.error("Error fetching companies: ",e)}},I=async()=>{try{let e=(await (0,c.PL)((0,c.hJ)(l.db,"users"))).docs.map(e=>({id:e.id,...e.data()}));L(e),h(e.length);let a={};e.forEach(e=>{let t=e.initiative;t&&(a[t]=(a[t]||0)+1)}),j(a)}catch(e){console.error("Error fetching users: ",e)}},P=async()=>{try{let e=(await (0,c.PL)((0,c.hJ)(l.db,"donations"))).docs.map(e=>({id:e.id,...e.data()})),a={};e.forEach(e=>{let t=e.initiative;t&&(a[t]=(a[t]||0)+1)}),y(a);let t={};e.forEach(e=>{let a=e.shop;a&&(t[a]=(t[a]||0)+1)}),b(Object.entries(t).map(e=>{let[a,t]=e;return{company:a,count:t}}))}catch(e){console.error("Error fetching donations: ",e)}},A={labels:Object.keys(f),datasets:[{label:"Donations by Initiative",data:Object.values(f),backgroundColor:"#007bff"}]},O={labels:N.map(e=>e.company),datasets:[{label:"Donations by Company",data:N.map(e=>e.count),backgroundColor:"#28a745"}]};return(0,n.jsxs)(m.Z,{children:[(0,n.jsxs)("div",{className:u().container,children:[(0,n.jsx)("header",{className:u().header,children:(0,n.jsx)("img",{src:"/images/more-logo-header.png",alt:"Company Logo",className:u().logo})}),(0,n.jsx)(_,{onAddCompany:S}),(0,n.jsxs)("div",{className:u().statsWrapper,children:[(0,n.jsx)("div",{className:u().statsItem,children:(0,n.jsx)(C,{count:p})}),(0,n.jsx)("div",{className:u().statsItem,children:(0,n.jsx)(g,{usersPerInitiative:x})})]}),(0,n.jsx)(v,{initiativeData:A,companyData:O})]}),(0,n.jsx)(E,{companies:t})]})},function(e){let[a,t]=(0,i.useState)(!0),[o,l]=(0,i.useState)(!1),d=(0,r.useRouter)();return((0,i.useEffect)(()=>{let e=(0,w.v0)(),a=(0,c.ad)(),s=(0,w.Aj)(e,async e=>{if(e){let t=(0,c.JU)(a,"users",e.uid),s=await (0,c.QT)(t);s.exists()&&"admin"===s.data().role?l(!0):d.push("/not-authorized")}else d.push("/login");t(!1)});return()=>s()},[d]),a)?(0,n.jsx)("div",{children:"Loading..."}):o?(0,n.jsx)(s,{...e}):null})},8461:function(e){e.exports={container:"DashboardLayout_container__804MW",sidebar:"DashboardLayout_sidebar__4NrPk",main:"DashboardLayout_main__N51_i",header:"DashboardLayout_header__csfNX",content:"DashboardLayout_content__zmmZZ"}},6944:function(e){e.exports={container:"ManageCompanies_container__I5sMO",card:"ManageCompanies_card__js9Io",title:"ManageCompanies_title__eC_CY",subtitle:"ManageCompanies_subtitle__neCda",form:"ManageCompanies_form__tlUhV",input:"ManageCompanies_input__SlQec",button:"ManageCompanies_button__fgtRR",stats:"ManageCompanies_stats__QR_Xj",chartContainer:"ManageCompanies_chartContainer__D_A7K",companyList:"ManageCompanies_companyList__E_lJQ",companyItem:"ManageCompanies_companyItem__c4R5o",statsWrapper:"ManageCompanies_statsWrapper__ZYjbZ",statsItem:"ManageCompanies_statsItem___CduP",totalUsersContainer:"ManageCompanies_totalUsersContainer__DzNap",statistics:"ManageCompanies_statistics__oAngY",totalUsersCard:"ManageCompanies_totalUsersCard__Lg5Jy",initiativesCard:"ManageCompanies_initiativesCard__zrMBN",graphCard:"ManageCompanies_graphCard__nSX_Y",totalUsersValue:"ManageCompanies_totalUsersValue__Ms4GU",totalUsersLabel:"ManageCompanies_totalUsersLabel__LWPwf",statTitle:"ManageCompanies_statTitle__MevVU",initiativeTable:"ManageCompanies_initiativeTable__PWEOP",initiativeRow:"ManageCompanies_initiativeRow__AVjEL",initiativeName:"ManageCompanies_initiativeName__a9SJJ",initiativeCount:"ManageCompanies_initiativeCount__0E4Fn",header:"ManageCompanies_header__GKRoq",logo:"ManageCompanies_logo__4nNW_"}}},function(e){e.O(0,[428,16,196,580,678,227,825,888,774,179],function(){return e(e.s=3259)}),_N_E=e.O()}]);