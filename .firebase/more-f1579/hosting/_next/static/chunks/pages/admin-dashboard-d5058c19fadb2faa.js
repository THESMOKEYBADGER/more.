(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{3259:function(a,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin-dashboard",function(){return t(2784)}])},4394:function(a,e,t){"use strict";var s=t(5893);t(7294);var n=t(890),i=t.n(n);e.Z=a=>{let{children:e}=a;return(0,s.jsx)("div",{className:i().container,children:(0,s.jsxs)("main",{className:i().main,children:[(0,s.jsx)("header",{className:i().header,children:(0,s.jsx)("h1",{})}),(0,s.jsx)("section",{className:i().content,children:e})]})})}},3444:function(a,e,t){"use strict";t.d(e,{I:function(){return o},db:function(){return c}});var s=t(3977);t(3059);var n=t(1259),i=t(9828);let r=(0,s.ZF)({apiKey:"AIzaSyAS2RAJanlflg5Xudy8VCFiUMAz1tpEKFw",authDomain:"more-f1579.firebaseapp.com",projectId:"more-f1579",storageBucket:"more-f1579.appspot.com",messagingSenderId:"675524787031",appId:"1:675524787031:web:e122a81b58e5154dd15c12",measurementId:"G-TJSHHBM91X"}),o=(0,n.v0)(r),c=(0,i.ad)(r)},2784:function(a,e,t){"use strict";let s;t.r(e),t.d(e,{default:function(){return N}});var n=t(5893),i=t(7294),r=t(1163),o=t(3349),c=t(3444),l=t(9828),m=t(7066),d=t(4394),p=t(8593),u=t.n(p),_=a=>{let{onAddCompany:e}=a,[t,s]=(0,i.useState)(""),[r,o]=(0,i.useState)("");return(0,n.jsxs)("form",{className:u().form,onSubmit:a=>{a.preventDefault(),e({name:t,location:r}),s(""),o("")},children:[(0,n.jsx)("input",{type:"text",placeholder:"Company Name",value:t,onChange:a=>s(a.target.value),required:!0,className:u().input}),(0,n.jsx)("input",{type:"text",placeholder:"Location",value:r,onChange:a=>o(a.target.value),required:!0,className:u().input}),(0,n.jsx)("button",{type:"submit",className:u().button,children:"Add Company"})]})};let h={1:"EarthChild project",2:"Green Pop",3:"Animal Ocean"};var g=a=>{let{totalUsers:e,usersPerInitiative:t}=a;return(0,n.jsx)("div",{className:u().statistics,children:(0,n.jsxs)("div",{className:u().initiativesCard,children:[(0,n.jsx)("h3",{className:u().statTitle,children:"Users per Initiative"}),(0,n.jsx)("div",{className:u().initiativeTable,children:Object.entries(t).map(a=>{let[e,t]=a;return(0,n.jsxs)("div",{className:u().initiativeRow,children:[(0,n.jsx)("span",{className:u().initiativeName,children:h[e]}),(0,n.jsx)("span",{className:u().initiativeCount,children:t})]},e)})})]})})},v=a=>{let{count:e}=a;return(0,n.jsx)("div",{className:u().totalUsersContainer,children:(0,n.jsxs)("div",{className:u().totalUsersCard,children:[(0,n.jsx)("h2",{className:u().totalUsersTitle,children:"Total Users"}),(0,n.jsx)("div",{className:u().totalUsersCount,children:e})]})})},x=t(6495),j=t(3148);j.kL.register(j.uw,j.f$,j.ZL,j.Dx,j.u,j.De);var b=a=>{let{initiativeData:e,companyData:t}=a,s={responsive:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Donations Overview"}}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:u().graphCard,children:[(0,n.jsx)("h2",{className:u().subtitle,children:"Donations by Initiative"}),(0,n.jsx)("div",{className:u().chartContainer,children:(0,n.jsx)(x.$Q,{data:e,options:s})})]}),(0,n.jsxs)("div",{className:u().graphCard,children:[(0,n.jsx)("h2",{className:u().subtitle,children:"Donations by Company"}),(0,n.jsx)("div",{className:u().chartContainer,children:(0,n.jsx)(x.$Q,{data:t,options:s})})]})]})},f=a=>{let{companies:e}=a;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:u().subtitle,children:"Company List"}),(0,n.jsx)("ul",{className:u().companyList,children:e.map(a=>(0,n.jsxs)("li",{className:u().companyItem,children:[a.name," - ",a.location]},a.id))})]})},y=t(1259);t(9033);var N=(s=()=>{let[a,e]=(0,o.F_)(c.I),[t,s]=(0,i.useState)([]),[p,h]=(0,i.useState)(0),[x,j]=(0,i.useState)({}),[y,N]=(0,i.useState)({}),[C,w]=(0,i.useState)([]),[I,E]=(0,i.useState)([]),U=(0,r.useRouter)();(0,i.useEffect)(()=>{e||a||U.push("/login")},[a,e,U]),(0,i.useEffect)(()=>{a&&(J(),T(),k())},[a]);let S=async a=>{try{await (0,l.ET)((0,l.hJ)(c.db,"companies"),a),J(),await L(a.name)}catch(a){console.error("Error adding company: ",a)}},L=async a=>{try{await m.Z.post("/api/notify-users",{companyName:a,users:I.map(a=>a.email)}),console.log("Notification request sent for all users")}catch(a){console.error("Error sending notification request: ",a)}},J=async()=>{try{let a=(await (0,l.PL)((0,l.hJ)(c.db,"companies"))).docs.map(a=>({id:a.id,...a.data()}));s(a)}catch(a){console.error("Error fetching companies: ",a)}},T=async()=>{try{let a=(await (0,l.PL)((0,l.hJ)(c.db,"users"))).docs.map(a=>({id:a.id,...a.data()}));E(a),h(a.length);let e={};a.forEach(a=>{let t=a.initiative;t&&(e[t]=(e[t]||0)+1)}),j(e)}catch(a){console.error("Error fetching users: ",a)}},k=async()=>{try{let a=(await (0,l.PL)((0,l.hJ)(c.db,"donations"))).docs.map(a=>({id:a.id,...a.data()})),e={1:"Earthchild",2:"GreenPop",3:"Animal Ocean"},t={};a.forEach(a=>{let s=a.initiative;if(s){let a=e[s]||"Unknown Initiative";t[a]=(t[a]||0)+1}}),N(t);let s={};a.forEach(a=>{let e=a.shop;e&&(s[e]=(s[e]||0)+1)}),w(Object.entries(s).map(a=>{let[e,t]=a;return{company:e,count:t}}))}catch(a){console.error("Error fetching donations: ",a)}},D={labels:Object.keys(y),datasets:[{label:"Donations by Initiative",data:Object.values(y),backgroundColor:"#007bff"}]},O={labels:C.map(a=>a.company),datasets:[{label:"Donations by Company",data:C.map(a=>a.count),backgroundColor:"#28a745"}]};return(0,n.jsxs)(d.Z,{children:[(0,n.jsxs)("div",{className:u().container,children:[(0,n.jsx)("header",{className:u().header,children:(0,n.jsx)("img",{src:"/images/more-logo-header.png",alt:"Company Logo",className:u().logo})}),(0,n.jsx)(_,{onAddCompany:S}),(0,n.jsxs)("div",{className:u().statsWrapper,children:[(0,n.jsx)("div",{className:u().statsItem,children:(0,n.jsx)(v,{count:p})}),(0,n.jsx)("div",{className:u().statsItem,children:(0,n.jsx)(g,{usersPerInitiative:x})})]}),(0,n.jsx)(b,{initiativeData:D,companyData:O})]}),(0,n.jsx)(f,{companies:t})]})},function(a){let[e,t]=(0,i.useState)(!0),[o,c]=(0,i.useState)(!1),m=(0,r.useRouter)();return((0,i.useEffect)(()=>{let a=(0,y.v0)(),e=(0,l.ad)(),s=(0,y.Aj)(a,async a=>{if(a){let t=(0,l.JU)(e,"users",a.uid),s=await (0,l.QT)(t);s.exists()&&"admin"===s.data().role?c(!0):m.push("/not-authorized")}else m.push("/login");t(!1)});return()=>s()},[m]),e)?(0,n.jsx)("div",{children:"Loading..."}):o?(0,n.jsx)(s,{...a}):null})},890:function(a){a.exports={container:"dashboard-layout_container__JitB7",sidebar:"dashboard-layout_sidebar__kHB7G",main:"dashboard-layout_main__OsxSz",header:"dashboard-layout_header__qdd_U",content:"dashboard-layout_content__U0_d9"}},8593:function(a){a.exports={container:"manage-companies_container__pCu6E",card:"manage-companies_card__eiYZC",title:"manage-companies_title__Bd8sX",subtitle:"manage-companies_subtitle__DKgnl",form:"manage-companies_form___iSiP",input:"manage-companies_input__t752r",button:"manage-companies_button__eYmo4",stats:"manage-companies_stats__I5Eff",chartContainer:"manage-companies_chartContainer__RcYas",companyList:"manage-companies_companyList__JwQdm",companyItem:"manage-companies_companyItem__tpr8G",statsWrapper:"manage-companies_statsWrapper__6Lfqr",statsItem:"manage-companies_statsItem__ondl5",totalUsersContainer:"manage-companies_totalUsersContainer__ZMFI6",statistics:"manage-companies_statistics__yJI94",totalUsersCard:"manage-companies_totalUsersCard__yrq1y",initiativesCard:"manage-companies_initiativesCard__JanNj",graphCard:"manage-companies_graphCard__TJ9ik",totalUsersValue:"manage-companies_totalUsersValue__QZ_ez",totalUsersLabel:"manage-companies_totalUsersLabel__lHntI",statTitle:"manage-companies_statTitle__c8owh",initiativeTable:"manage-companies_initiativeTable__O_aGb",initiativeRow:"manage-companies_initiativeRow__wxPJc",initiativeName:"manage-companies_initiativeName__iJ_kA",initiativeCount:"manage-companies_initiativeCount__ao_sn",header:"manage-companies_header__OF2Xr",logo:"manage-companies_logo__dDAHp"}}},function(a){a.O(0,[428,16,196,580,649,438,637,888,774,179],function(){return a(a.s=3259)}),_N_E=a.O()}]);