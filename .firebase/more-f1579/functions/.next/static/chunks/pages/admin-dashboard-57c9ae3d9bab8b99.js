(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{3259:function(a,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin-dashboard",function(){return t(2784)}])},4394:function(a,e,t){"use strict";var s=t(5893);t(7294);var n=t(8461),i=t.n(n);e.Z=a=>{let{children:e}=a;return(0,s.jsx)("div",{className:i().container,children:(0,s.jsxs)("main",{className:i().main,children:[(0,s.jsx)("header",{className:i().header,children:(0,s.jsx)("h1",{})}),(0,s.jsx)("section",{className:i().content,children:e})]})})}},3444:function(a,e,t){"use strict";t.d(e,{I:function(){return o},db:function(){return l}});var s=t(3977);t(3059);var n=t(1259),i=t(9828);let r=(0,s.ZF)({apiKey:"AIzaSyAS2RAJanlflg5Xudy8VCFiUMAz1tpEKFw",authDomain:"more-f1579.firebaseapp.com",projectId:"more-f1579",storageBucket:"more-f1579.appspot.com",messagingSenderId:"675524787031",appId:"1:675524787031:web:e122a81b58e5154dd15c12",measurementId:"G-TJSHHBM91X"}),o=(0,n.v0)(r),l=(0,i.ad)(r)},2784:function(a,e,t){"use strict";let s;t.r(e),t.d(e,{default:function(){return f}});var n=t(5893),i=t(7294),r=t(1163),o=t(3349),l=t(3444),c=t(9828),d=t(7066),m=t(4394),u=t(6944),_=t.n(u),p=a=>{let{onAddCompany:e}=a,[t,s]=(0,i.useState)(""),[r,o]=(0,i.useState)("");return(0,n.jsxs)("form",{className:_().form,onSubmit:a=>{a.preventDefault(),e({name:t,location:r}),s(""),o("")},children:[(0,n.jsx)("input",{type:"text",placeholder:"Company Name",value:t,onChange:a=>s(a.target.value),required:!0,className:_().input}),(0,n.jsx)("input",{type:"text",placeholder:"Location",value:r,onChange:a=>o(a.target.value),required:!0,className:_().input}),(0,n.jsx)("button",{type:"submit",className:_().button,children:"Add Company"})]})};let h={1:"EarthChild project",2:"Green Pop",3:"Animal Ocean"};var g=a=>{let{totalUsers:e,usersPerInitiative:t}=a;return(0,n.jsx)("div",{className:_().statistics,children:(0,n.jsxs)("div",{className:_().initiativesCard,children:[(0,n.jsx)("h3",{className:_().statTitle,children:"Users per Initiative"}),(0,n.jsx)("div",{className:_().initiativeTable,children:Object.entries(t).map(a=>{let[e,t]=a;return(0,n.jsxs)("div",{className:_().initiativeRow,children:[(0,n.jsx)("span",{className:_().initiativeName,children:h[e]}),(0,n.jsx)("span",{className:_().initiativeCount,children:t})]},e)})})]})})},C=a=>{let{count:e}=a;return(0,n.jsx)("div",{className:_().totalUsersContainer,children:(0,n.jsxs)("div",{className:_().totalUsersCard,children:[(0,n.jsx)("h2",{className:_().totalUsersTitle,children:"Total Users"}),(0,n.jsx)("div",{className:_().totalUsersCount,children:e})]})})},v=t(6495),j=t(3148);j.kL.register(j.uw,j.f$,j.ZL,j.Dx,j.u,j.De);var x=a=>{let{initiativeData:e,companyData:t}=a,s={responsive:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Donations Overview"}}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:_().graphCard,children:[(0,n.jsx)("h2",{className:_().subtitle,children:"Donations by Initiative"}),(0,n.jsx)("div",{className:_().chartContainer,children:(0,n.jsx)(v.$Q,{data:e,options:s})})]}),(0,n.jsxs)("div",{className:_().graphCard,children:[(0,n.jsx)("h2",{className:_().subtitle,children:"Donations by Company"}),(0,n.jsx)("div",{className:_().chartContainer,children:(0,n.jsx)(v.$Q,{data:t,options:s})})]})]})},b=a=>{let{companies:e}=a;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:_().subtitle,children:"Company List"}),(0,n.jsx)("ul",{className:_().companyList,children:e.map(a=>(0,n.jsxs)("li",{className:_().companyItem,children:[a.name," - ",a.location]},a.id))})]})},N=t(1259);t(9033);var f=(s=()=>{let[a,e]=(0,o.F_)(l.I),[t,s]=(0,i.useState)([]),[u,h]=(0,i.useState)(0),[v,j]=(0,i.useState)({}),[N,f]=(0,i.useState)({}),[y,M]=(0,i.useState)([]),[E,L]=(0,i.useState)([]),w=(0,r.useRouter)();(0,i.useEffect)(()=>{e||a||w.push("/login")},[a,e,w]),(0,i.useEffect)(()=>{a&&(D(),S(),T())},[a]);let I=async a=>{try{await (0,c.ET)((0,c.hJ)(l.db,"companies"),a),D(),await U(a.name)}catch(a){console.error("Error adding company: ",a)}},U=async a=>{try{await d.Z.post("/api/notify-users",{companyName:a,users:E.map(a=>a.email)}),console.log("Notification request sent for all users")}catch(a){console.error("Error sending notification request: ",a)}},D=async()=>{try{let a=(await (0,c.PL)((0,c.hJ)(l.db,"companies"))).docs.map(a=>({id:a.id,...a.data()}));s(a)}catch(a){console.error("Error fetching companies: ",a)}},S=async()=>{try{let a=(await (0,c.PL)((0,c.hJ)(l.db,"users"))).docs.map(a=>({id:a.id,...a.data()}));L(a),h(a.length);let e={};a.forEach(a=>{let t=a.initiative;t&&(e[t]=(e[t]||0)+1)}),j(e)}catch(a){console.error("Error fetching users: ",a)}},T=async()=>{try{let a=(await (0,c.PL)((0,c.hJ)(l.db,"donations"))).docs.map(a=>({id:a.id,...a.data()})),e={};a.forEach(a=>{let t=a.initiative;t&&(e[t]=(e[t]||0)+1)}),f(e);let t={};a.forEach(a=>{let e=a.shop;e&&(t[e]=(t[e]||0)+1)}),M(Object.entries(t).map(a=>{let[e,t]=a;return{company:e,count:t}}))}catch(a){console.error("Error fetching donations: ",a)}},P={labels:Object.keys(N),datasets:[{label:"Donations by Initiative",data:Object.values(N),backgroundColor:"#007bff"}]},A={labels:y.map(a=>a.company),datasets:[{label:"Donations by Company",data:y.map(a=>a.count),backgroundColor:"#28a745"}]};return(0,n.jsxs)(m.Z,{children:[(0,n.jsxs)("div",{className:_().container,children:[(0,n.jsx)("header",{className:_().header,children:(0,n.jsx)("img",{src:"/images/more-logo-header.png",alt:"Company Logo",className:_().logo})}),(0,n.jsx)(p,{onAddCompany:I}),(0,n.jsxs)("div",{className:_().statsWrapper,children:[(0,n.jsx)("div",{className:_().statsItem,children:(0,n.jsx)(C,{count:u})}),(0,n.jsx)("div",{className:_().statsItem,children:(0,n.jsx)(g,{usersPerInitiative:v})})]}),(0,n.jsx)(x,{initiativeData:P,companyData:A})]}),(0,n.jsx)(b,{companies:t})]})},function(a){let[e,t]=(0,i.useState)(!0),[o,l]=(0,i.useState)(!1),d=(0,r.useRouter)();return((0,i.useEffect)(()=>{let a=(0,N.v0)(),e=(0,c.ad)(),s=(0,N.Aj)(a,async a=>{if(a){let t=(0,c.JU)(e,"users",a.uid),s=await (0,c.QT)(t);s.exists()&&"admin"===s.data().role?l(!0):d.push("/not-authorized")}else d.push("/login");t(!1)});return()=>s()},[d]),e)?(0,n.jsx)("div",{children:"Loading..."}):o?(0,n.jsx)(s,{...a}):null})},8461:function(a){a.exports={container:"DashboardLayout_container__804MW",sidebar:"DashboardLayout_sidebar__4NrPk",main:"DashboardLayout_main__N51_i",header:"DashboardLayout_header__csfNX",content:"DashboardLayout_content__zmmZZ"}},6944:function(a){a.exports={container:"ManageCompanies_container__I5sMO",card:"ManageCompanies_card__js9Io",title:"ManageCompanies_title__eC_CY",subtitle:"ManageCompanies_subtitle__neCda",form:"ManageCompanies_form__tlUhV",input:"ManageCompanies_input__SlQec",button:"ManageCompanies_button__fgtRR",stats:"ManageCompanies_stats__QR_Xj",chartContainer:"ManageCompanies_chartContainer__D_A7K",companyList:"ManageCompanies_companyList__E_lJQ",companyItem:"ManageCompanies_companyItem__c4R5o",statsWrapper:"ManageCompanies_statsWrapper__ZYjbZ",statsItem:"ManageCompanies_statsItem___CduP",totalUsersContainer:"ManageCompanies_totalUsersContainer__DzNap",statistics:"ManageCompanies_statistics__oAngY",totalUsersCard:"ManageCompanies_totalUsersCard__Lg5Jy",initiativesCard:"ManageCompanies_initiativesCard__zrMBN",graphCard:"ManageCompanies_graphCard__nSX_Y",totalUsersValue:"ManageCompanies_totalUsersValue__Ms4GU",totalUsersLabel:"ManageCompanies_totalUsersLabel__LWPwf",statTitle:"ManageCompanies_statTitle__MevVU",initiativeTable:"ManageCompanies_initiativeTable__PWEOP",initiativeRow:"ManageCompanies_initiativeRow__AVjEL",initiativeName:"ManageCompanies_initiativeName__a9SJJ",initiativeCount:"ManageCompanies_initiativeCount__0E4Fn",header:"ManageCompanies_header__GKRoq",logo:"ManageCompanies_logo__4nNW_"}}},function(a){a.O(0,[428,16,196,580,649,438,637,888,774,179],function(){return a(a.s=3259)}),_N_E=a.O()}]);